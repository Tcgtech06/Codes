================================================================================
                    KNITINFO DIRECTORY - DATABASE OPERATIONS & USER STORIES
================================================================================

This document outlines all database operations required for the KnitInfo Directory 
webapp, organized by sections with corresponding user stories.

================================================================================
SECTION 1: HOME PAGE & LANDING EXPERIENCE
================================================================================

USER STORY 1.1: Visitor Landing Experience
"As a visitor, I want to see featured categories and latest companies when I 
visit the homepage, so I can quickly understand what the directory offers."

DATABASE OPERATIONS:
- READ: categories collection (where isActive = true, orderBy displayOrder, limit 6)
- READ: companies collection (where status = active, orderBy createdAt desc, limit 6)
- READ: app_settings collection (document: general)

QUERIES NEEDED:
1. getFeaturedCategories()
   - Collection: categories
   - Filters: isActive == true
   - Sort: displayOrder ASC
   - Limit: 6

2. getLatestCompanies()
   - Collection: companies
   - Filters: status == 'active'
   - Sort: createdAt DESC
   - Limit: 6

3. getAppSettings()
   - Collection: app_settings
   - Document: general

USER STORY 1.2: Hero Slideshow Display
"As a visitor, I want to see an attractive slideshow on the homepage that 
showcases the textile industry, so I feel engaged with the platform."

DATABASE OPERATIONS:
- READ: app_settings collection (document: homepage_slides)

QUERIES NEEDED:
1. getHomepageSlides()
   - Collection: app_settings
   - Document: homepage_slides
   - Fields: slides array with image URLs and captions

================================================================================
SECTION 2: BOOKS CATALOG & ORDERING
================================================================================

USER STORY 2.1: Browse Books Catalog
"As a visitor, I want to browse available books related to the textile industry, 
so I can find educational resources that interest me."

DATABASE OPERATIONS:
- READ: books collection (where status = active, orderBy createdAt desc)
- READ: books collection (distinct categories for filtering)

QUERIES NEEDED:
1. getAllBooks()
   - Collection: books
   - Filters: status == 'active'
   - Sort: createdAt DESC

2. getBookCategories()
   - Collection: books
   - Filters: status == 'active'
   - Aggregate: distinct categories

USER STORY 2.2: View Individual Book Details
"As a potential customer, I want to see detailed information about a specific 
book including price and description, so I can decide whether to purchase it."

DATABASE OPERATIONS:
- READ: books collection (single document by ID)

QUERIES NEEDED:
1. getBookById(bookId)
   - Collection: books
   - Document: bookId
   - Return: complete book details

USER STORY 2.3: Place Book Order
"As a customer, I want to order a book through WhatsApp with pre-filled details, 
so I can easily complete my purchase."

DATABASE OPERATIONS:
- CREATE: orders collection (new order document)
- UPDATE: books collection (decrement stock if tracking inventory)

QUERIES NEEDED:
1. createOrder(orderData)
   - Collection: orders
   - Operation: CREATE
   - Data: customer info, book details, quantity, total amount

2. updateBookStock(bookId, quantity)
   - Collection: books
   - Document: bookId
   - Operation: UPDATE
   - Field: stock (decrement by quantity)

================================================================================
SECTION 3: BUSINESS DIRECTORY & CATALOG
================================================================================

USER STORY 3.1: Browse Business Categories
"As a business owner or buyer, I want to see all available business categories 
with company counts, so I can navigate to the category I'm interested in."

DATABASE OPERATIONS:
- READ: categories collection (where isActive = true, orderBy displayOrder)
- READ: companies collection (count by category)

QUERIES NEEDED:
1. getCategoriesWithCounts()
   - Collection: categories
   - Filters: isActive == true
   - Sort: displayOrder ASC
   - Additional: count companies per category

2. getCompanyCountByCategory(categoryName)
   - Collection: companies
   - Filters: category == categoryName, status == 'active'
   - Operation: COUNT

USER STORY 3.2: View Companies in Category
"As a buyer, I want to see all companies in a specific category with search 
and filter options, so I can find suppliers that meet my requirements."

DATABASE OPERATIONS:
- READ: companies collection (filtered by category, status, optional city)
- READ: priorities collection (for the category to sort results)

QUERIES NEEDED:
1. getCompaniesByCategory(categoryName, filters)
   - Collection: companies
   - Filters: category == categoryName, status == 'active'
   - Optional: city filter
   - Sort: by priority position, then createdAt

2. getPrioritiesByCategory(categoryName)
   - Collection: priorities
   - Filters: category == categoryName, status == 'active'
   - Additional: check expiry for temporary priorities
   - Sort: position ASC

USER STORY 3.3: Search Companies
"As a buyer, I want to search for companies by name, products, or description, 
so I can quickly find specific suppliers."

DATABASE OPERATIONS:
- READ: companies collection (with text-based filtering)

QUERIES NEEDED:
1. searchCompanies(searchTerm, categoryFilter)
   - Collection: companies
   - Filters: status == 'active', optional category
   - Client-side: text search in name, description, products
   - Sort: relevance, then priority

================================================================================
SECTION 4: COMPANY REGISTRATION & FORM SUBMISSIONS
================================================================================

USER STORY 4.1: Submit Company Information
"As a business owner, I want to submit my company details through a form, 
so I can get listed in the directory."

DATABASE OPERATIONS:
- CREATE: form_submissions collection (type: add-data)
- UPLOAD: Firebase Storage (visiting card, documents)

QUERIES NEEDED:
1. submitAddDataForm(formData, files)
   - Collection: form_submissions
   - Operation: CREATE
   - Data: type='add-data', formData, attachments, status='pending'

2. uploadFormAttachments(files, submissionId)
   - Storage: form-attachments/{submissionId}/
   - Operation: UPLOAD
   - Return: array of download URLs

USER STORY 4.2: Submit Advertising Request
"As a business owner, I want to request advertising opportunities, 
so I can promote my business on the platform."

DATABASE OPERATIONS:
- CREATE: form_submissions collection (type: advertise)

QUERIES NEEDED:
1. submitAdvertiseForm(formData)
   - Collection: form_submissions
   - Operation: CREATE
   - Data: type='advertise', formData, status='pending'

USER STORY 4.3: Submit Collaboration Proposal
"As an organization, I want to propose collaboration opportunities, 
so I can partner with the platform for mutual benefit."

DATABASE OPERATIONS:
- CREATE: form_submissions collection (type: collaborate)

QUERIES NEEDED:
1. submitCollaborateForm(formData)
   - Collection: form_submissions
   - Operation: CREATE
   - Data: type='collaborate', formData, status='pending'

================================================================================
SECTION 5: ADMIN AUTHENTICATION & ACCESS CONTROL
================================================================================

USER STORY 5.1: Admin Login
"As an admin, I want to securely log into the admin panel using my credentials, 
so I can manage the platform."

DATABASE OPERATIONS:
- READ: Firebase Authentication (email/password verification)
- READ: users collection (get user profile and permissions)
- UPDATE: users collection (update last login timestamp)

QUERIES NEEDED:
1. adminLogin(email, password)
   - Service: Firebase Auth
   - Operation: signInWithEmailAndPassword
   - Additional: verify admin role

2. getUserProfile(uid)
   - Collection: users
   - Document: uid
   - Return: role, permissions, profile data

3. updateLastLogin(uid)
   - Collection: users
   - Document: uid
   - Operation: UPDATE
   - Field: lastLogin timestamp

USER STORY 5.2: Admin Session Management
"As an admin, I want my session to be maintained securely and expire appropriately, 
so the platform remains secure."

DATABASE OPERATIONS:
- READ: Firebase Authentication (verify current session)
- UPDATE: users collection (session activity tracking)

QUERIES NEEDED:
1. verifyAdminSession()
   - Service: Firebase Auth
   - Operation: getCurrentUser
   - Additional: check user role and permissions

================================================================================
SECTION 6: ADMIN DASHBOARD & ANALYTICS
================================================================================

USER STORY 6.1: View Dashboard Statistics
"As an admin, I want to see key statistics about the platform (companies, 
submissions, orders), so I can monitor platform health."

DATABASE OPERATIONS:
- READ: companies collection (count by status)
- READ: form_submissions collection (count by type and status)
- READ: orders collection (count and recent orders)
- READ: priorities collection (count active priorities)

QUERIES NEEDED:
1. getDashboardStats()
   - Multiple collections: companies, form_submissions, orders, priorities
   - Operations: COUNT aggregations
   - Return: comprehensive statistics object

2. getCompanyStats()
   - Collection: companies
   - Aggregate: count by status, count by category

3. getSubmissionStats()
   - Collection: form_submissions
   - Aggregate: count by type, count by status

4. getRecentOrders(limit)
   - Collection: orders
   - Sort: createdAt DESC
   - Limit: specified number

USER STORY 6.2: View Form Submissions
"As an admin, I want to review all form submissions (add-data, advertise, 
collaborate) with filtering options, so I can process them efficiently."

DATABASE OPERATIONS:
- READ: form_submissions collection (with type and status filters)

QUERIES NEEDED:
1. getSubmissionsByType(type)
   - Collection: form_submissions
   - Filters: type == specified type
   - Sort: submittedAt DESC

2. getSubmissionsByStatus(status)
   - Collection: form_submissions
   - Filters: status == specified status
   - Sort: submittedAt DESC

3. getAllSubmissions()
   - Collection: form_submissions
   - Sort: submittedAt DESC

================================================================================
SECTION 7: COMPANY PRIORITY MANAGEMENT
================================================================================

USER STORY 7.1: Set Company Priority
"As an admin, I want to set priority rankings for companies in specific 
categories, so important companies appear first in search results."

DATABASE OPERATIONS:
- CREATE: priorities collection (new priority record)
- READ: priorities collection (check for existing position conflicts)

QUERIES NEEDED:
1. createPriority(priorityData)
   - Collection: priorities
   - Operation: CREATE
   - Validation: check position availability
   - Data: company, category, position, type, expiry

2. checkPriorityPosition(category, position)
   - Collection: priorities
   - Filters: category == category, position == position, status == 'active'
   - Operation: EXISTS check

USER STORY 7.2: Manage Existing Priorities
"As an admin, I want to view, edit, and remove existing company priorities, 
so I can maintain accurate rankings."

DATABASE OPERATIONS:
- READ: priorities collection (all active priorities)
- UPDATE: priorities collection (modify existing priority)
- DELETE: priorities collection (soft delete by status change)

QUERIES NEEDED:
1. getAllPriorities()
   - Collection: priorities
   - Filters: status == 'active'
   - Sort: category ASC, position ASC

2. updatePriority(priorityId, updates)
   - Collection: priorities
   - Document: priorityId
   - Operation: UPDATE
   - Fields: position, duration, expiry, etc.

3. deletePriority(priorityId)
   - Collection: priorities
   - Document: priorityId
   - Operation: UPDATE
   - Field: status = 'deleted'

USER STORY 7.3: Handle Priority Expiration
"As the system, I want to automatically handle expired temporary priorities, 
so the rankings remain current without manual intervention."

DATABASE OPERATIONS:
- READ: priorities collection (temporary priorities past expiry)
- UPDATE: priorities collection (mark expired priorities as inactive)

QUERIES NEEDED:
1. cleanExpiredPriorities()
   - Collection: priorities
   - Filters: priorityType == 'temporary', expiresAt <= now, status == 'active'
   - Operation: BATCH UPDATE
   - Field: status = 'expired'

================================================================================
SECTION 8: EXCEL DATA UPLOAD & PROCESSING
================================================================================

USER STORY 8.1: Upload Excel File
"As an admin, I want to upload Excel files containing company data, 
so I can bulk import companies into the directory."

DATABASE OPERATIONS:
- CREATE: excel_uploads collection (upload tracking record)
- UPLOAD: Firebase Storage (Excel file)
- CREATE: companies collection (bulk create from Excel data)

QUERIES NEEDED:
1. createUploadRecord(uploadData)
   - Collection: excel_uploads
   - Operation: CREATE
   - Data: filename, category, status='processing', admin user

2. uploadExcelFile(file, category)
   - Storage: uploads/excel-files/
   - Operation: UPLOAD
   - Return: download URL

3. processExcelData(excelData, category)
   - Collection: companies
   - Operation: BULK CREATE
   - Validation: data format, duplicates
   - Error handling: track success/failure rates

USER STORY 8.2: Track Upload Progress
"As an admin, I want to see the progress and results of Excel uploads, 
so I know how many records were processed successfully."

DATABASE OPERATIONS:
- UPDATE: excel_uploads collection (progress and results)
- READ: excel_uploads collection (upload history)

QUERIES NEEDED:
1. updateUploadProgress(uploadId, progress)
   - Collection: excel_uploads
   - Document: uploadId
   - Operation: UPDATE
   - Fields: status, recordsCount, successCount, errorCount

2. getUploadHistory()
   - Collection: excel_uploads
   - Sort: uploadedAt DESC
   - Return: upload records with results

================================================================================
SECTION 9: FORM SUBMISSION APPROVAL WORKFLOW
================================================================================

USER STORY 9.1: Review and Approve Company Submissions
"As an admin, I want to review company submission details and approve them 
to create active company listings, so quality is maintained."

DATABASE OPERATIONS:
- READ: form_submissions collection (pending add-data submissions)
- CREATE: companies collection (approved company record)
- UPDATE: form_submissions collection (mark as approved)

QUERIES NEEDED:
1. getPendingSubmissions()
   - Collection: form_submissions
   - Filters: type == 'add-data', status == 'pending'
   - Sort: submittedAt ASC

2. approveSubmission(submissionId)
   - Collection: companies (CREATE new company)
   - Collection: form_submissions (UPDATE status to 'approved')
   - Data transformation: form data to company record

3. rejectSubmission(submissionId, reason)
   - Collection: form_submissions
   - Document: submissionId
   - Operation: UPDATE
   - Fields: status='rejected', reviewNotes=reason

USER STORY 9.2: Handle Advertising Requests
"As an admin, I want to review advertising requests and respond to them, 
so I can manage platform monetization."

DATABASE OPERATIONS:
- READ: form_submissions collection (advertise type)
- UPDATE: form_submissions collection (update status and notes)

QUERIES NEEDED:
1. getAdvertisingRequests()
   - Collection: form_submissions
   - Filters: type == 'advertise'
   - Sort: submittedAt DESC

2. updateAdvertisingRequest(submissionId, status, notes)
   - Collection: form_submissions
   - Document: submissionId
   - Operation: UPDATE
   - Fields: status, reviewNotes, reviewedAt

================================================================================
SECTION 10: SEARCH & FILTERING OPERATIONS
================================================================================

USER STORY 10.1: Global Platform Search
"As a user, I want to search across all companies using keywords, 
so I can find relevant businesses quickly."

DATABASE OPERATIONS:
- READ: companies collection (with client-side text filtering)

QUERIES NEEDED:
1. globalSearch(searchTerm, filters)
   - Collection: companies
   - Filters: status == 'active', optional category/city
   - Client-side: text search in name, description, products
   - Sort: relevance score, priority position

USER STORY 10.2: Advanced Filtering
"As a user, I want to filter companies by category, location, and other 
criteria, so I can narrow down my search results."

DATABASE OPERATIONS:
- READ: companies collection (with multiple filter conditions)

QUERIES NEEDED:
1. getFilteredCompanies(filters)
   - Collection: companies
   - Filters: category, city, status, etc.
   - Sort: priority, then createdAt
   - Pagination: support for large result sets

USER STORY 10.3: Search Suggestions
"As a user, I want to see search suggestions as I type, 
so I can find what I'm looking for more easily."

DATABASE OPERATIONS:
- READ: companies collection (for auto-complete data)

QUERIES NEEDED:
1. getSearchSuggestions(partialTerm)
   - Collection: companies
   - Client-side: match company names and products
   - Return: array of suggestion strings
   - Limit: 10 suggestions

================================================================================
SECTION 11: NOTIFICATION & COMMUNICATION
================================================================================

USER STORY 11.1: Admin Notifications
"As an admin, I want to receive notifications when new submissions arrive, 
so I can respond promptly to user requests."

DATABASE OPERATIONS:
- CREATE: notifications collection (notification records)
- READ: app_settings collection (notification preferences)

QUERIES NEEDED:
1. createNotification(type, data)
   - Collection: notifications
   - Operation: CREATE
   - Data: type, message, recipient, status='pending'

2. sendAdminAlert(type, data)
   - External: Email/SMS service integration
   - Trigger: form submissions, critical errors, etc.

USER STORY 11.2: Customer Confirmations
"As a customer, I want to receive confirmation when I submit forms or place 
orders, so I know my request was received."

DATABASE OPERATIONS:
- CREATE: notifications collection (customer confirmation records)

QUERIES NEEDED:
1. sendCustomerConfirmation(type, customerData)
   - Collection: notifications
   - Operation: CREATE
   - External: Email service integration

================================================================================
SECTION 12: ANALYTICS & REPORTING
================================================================================

USER STORY 12.1: Platform Analytics
"As an admin, I want to see analytics about platform usage, popular categories, 
and growth trends, so I can make informed decisions."

DATABASE OPERATIONS:
- READ: companies collection (category distribution)
- READ: form_submissions collection (submission trends)
- READ: orders collection (sales analytics)

QUERIES NEEDED:
1. getCategoryAnalytics()
   - Collection: companies
   - Aggregate: count by category
   - Return: category distribution data

2. getSubmissionTrends(timeframe)
   - Collection: form_submissions
   - Filters: date range
   - Aggregate: count by month/week
   - Return: trend data

3. getOrderAnalytics()
   - Collection: orders
   - Aggregate: revenue, popular books
   - Return: sales analytics

USER STORY 12.2: Export Data
"As an admin, I want to export company and submission data to Excel/CSV, 
so I can perform external analysis or create reports."

DATABASE OPERATIONS:
- READ: companies collection (all or filtered data)
- READ: form_submissions collection (all or filtered data)

QUERIES NEEDED:
1. exportCompaniesData(filters)
   - Collection: companies
   - Filters: optional category, date range
   - Format: Excel/CSV export

2. exportSubmissionsData(filters)
   - Collection: form_submissions
   - Filters: optional type, status, date range
   - Format: Excel/CSV export

================================================================================
SECTION 13: BACKUP & MAINTENANCE
================================================================================

USER STORY 13.1: Data Backup
"As a system administrator, I want automated daily backups of all data, 
so the platform can recover from any data loss incidents."

DATABASE OPERATIONS:
- READ: All collections (complete data export)
- CREATE: backups collection (backup metadata)

QUERIES NEEDED:
1. createDailyBackup()
   - Collections: ALL (companies, priorities, submissions, etc.)
   - Operation: EXPORT all data
   - Storage: backup location with timestamp

2. cleanupOldBackups(retentionDays)
   - Collection: backups
   - Filters: createdAt < retention period
   - Operation: DELETE old backup records

USER STORY 13.2: Data Migration
"As a system administrator, I want to migrate data from localStorage to 
Firebase when setting up the platform, so existing data is preserved."

DATABASE OPERATIONS:
- READ: localStorage data (priorities, submissions)
- CREATE: Firebase collections (migrated data)

QUERIES NEEDED:
1. migratePriorities()
   - Source: localStorage 'companyPriorities'
   - Target: priorities collection
   - Operation: BULK CREATE with data transformation

2. migrateSubmissions()
   - Source: localStorage submission arrays
   - Target: form_submissions collection
   - Operation: BULK CREATE with type assignment

================================================================================
SECTION 14: PERFORMANCE & OPTIMIZATION
================================================================================

USER STORY 14.1: Fast Search Results
"As a user, I want search results to load quickly even with large amounts 
of data, so I have a smooth browsing experience."

DATABASE OPERATIONS:
- READ: companies collection (with optimized indexes)
- CACHE: frequently accessed data

QUERIES NEEDED:
1. getOptimizedCompanyList(filters, pagination)
   - Collection: companies
   - Indexes: category+status+createdAt, status+createdAt
   - Pagination: cursor-based for large datasets
   - Cache: category lists, popular searches

USER STORY 14.2: Efficient Priority Sorting
"As a user, I want priority companies to appear first in results without 
affecting search performance, so I see the most relevant companies quickly."

DATABASE OPERATIONS:
- READ: priorities collection (active priorities only)
- READ: companies collection (with priority-aware sorting)

QUERIES NEEDED:
1. getPrioritizedCompanies(category)
   - Collections: companies + priorities (JOIN operation)
   - Indexes: priorities(category+status+position)
   - Cache: priority mappings per category

================================================================================
SECTION 15: ERROR HANDLING & MONITORING
================================================================================

USER STORY 15.1: Error Tracking
"As a system administrator, I want to track and monitor all database errors, 
so I can maintain platform reliability."

DATABASE OPERATIONS:
- CREATE: error_logs collection (error tracking)
- READ: performance_metrics collection (monitoring data)

QUERIES NEEDED:
1. logError(error, context)
   - Collection: error_logs
   - Operation: CREATE
   - Data: error details, stack trace, context, severity

2. getErrorMetrics(timeframe)
   - Collection: error_logs
   - Aggregate: count by type, severity
   - Return: error analytics

USER STORY 15.2: Performance Monitoring
"As a system administrator, I want to monitor database query performance, 
so I can optimize slow operations."

DATABASE OPERATIONS:
- CREATE: performance_metrics collection (query timing)
- READ: performance_metrics collection (analysis)

QUERIES NEEDED:
1. logQueryPerformance(query, duration)
   - Collection: performance_metrics
   - Operation: CREATE
   - Data: query type, duration, timestamp

2. getSlowQueries(threshold)
   - Collection: performance_metrics
   - Filters: duration > threshold
   - Return: slow query analysis

================================================================================
SUMMARY OF REQUIRED DATABASE INDEXES
================================================================================

FIRESTORE COMPOSITE INDEXES NEEDED:

1. companies collection:
   - category (ASC) + status (ASC) + createdAt (DESC)
   - status (ASC) + createdAt (DESC)
   - category (ASC) + city (ASC) + status (ASC)

2. priorities collection:
   - category (ASC) + status (ASC) + position (ASC)
   - priorityType (ASC) + expiresAt (ASC) + status (ASC)

3. form_submissions collection:
   - type (ASC) + submittedAt (DESC)
   - status (ASC) + submittedAt (DESC)
   - type (ASC) + status (ASC) + submittedAt (DESC)

4. orders collection:
   - orderStatus (ASC) + createdAt (DESC)
   - createdAt (DESC)

5. excel_uploads collection:
   - uploadedBy (ASC) + uploadedAt (DESC)
   - status (ASC) + uploadedAt (DESC)

================================================================================
TOTAL DATABASE OPERATIONS SUMMARY
================================================================================

CREATE Operations: 15 different types
READ Operations: 45 different queries
UPDATE Operations: 12 different types
DELETE Operations: 5 different types (mostly soft deletes)

Collections Used: 9 main collections
Storage Buckets: 5 different file types
External Services: Email, SMS, WhatsApp integration

This comprehensive list covers every database operation needed for the complete
KnitInfo Directory webapp functionality, organized by user stories and sections.

================================================================================